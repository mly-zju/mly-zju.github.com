<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
    <title>python中的序列化与反序列化 | 马龄阳的个人网站</title>
    <script>
        var html = document.getElementsByTagName('html')[0];
        var rem = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
        html.style.fontSize = rem / 10 + 'px';
    </script>
    <script>
        (function(i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function() {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-93174249-1', 'auto');
        ga('send', 'pageview');
    </script>
    <link href="/Users/malingyang/Workspace/mly-zju.github.com/css/article/index.min.css" type="text/css" rel="stylesheet" />
    <link href="/Users/malingyang/Workspace/mly-zju.github.com/css/pygments.css" type="text/css" rel="stylesheet" />
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?">
    <script src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script>
</head>

<body>
    <div class="wrap">
        <div class="left-main">
            <div class="avatar"></div>
            <h2>马龄阳</h2>
            <!-- <h5>风烟俱净</h5> -->
            <div class="contact">
                <a class="github" href="https://github.com/mly-zju"></a>
            </div>
            <div class="all-page left-item current"><a href="/Users/malingyang/Workspace/mly-zju.github.com/index.html">文章</a></div>
            <div class="category left-item"><a href="/Users/malingyang/Workspace/mly-zju.github.com/category/diary.html">分类</a></div>
            <div class="about left-item"><a href="/Users/malingyang/Workspace/mly-zju.github.com/about.html">关于我</a></div>
        </div>
        <div class="right-main">
            <div class="article-detail-wrap" style="overflow: hidden;">
                <div class="article-detail">
                    <h2 class="article-title">python中的序列化与反序列化</h2>
                    <h3 class="article-date">04 Jan 2016</h3> <p>感慨一下最近工作还是有点辛苦的，但是怎么说呢，还是痛并快乐着吧<!--more-->，每天都在学习和思考，每天都有收获。最近在开发中经常遇到在python中序列化与反序列化的问题。其实更具体一点就是将python对象同json字符串相互转化的问题。这里做一点小结。</p>

<p>话不多说，用一个例子来说明所有的要点吧。</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">json</span>
<span class="k">print</span> <span class="s">"Test1:"</span>
<span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="s">'Tom'</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="bp">True</span><span class="p">]</span>
<span class="n">y</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="k">print</span> <span class="n">y</span>
<span class="k">print</span> <span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">x2</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">x2</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">ele</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">ele</span><span class="p">)</span>

<span class="k">print</span> <span class="s">"Test2:"</span>
<span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="s">'Tom'</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span>
<span class="n">y</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="k">print</span> <span class="n">y</span>
<span class="k">print</span> <span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">x2</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="k">print</span> <span class="nb">type</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>

<span class="k">print</span> <span class="s">"Test3"</span>
<span class="n">x</span><span class="o">=</span><span class="p">{</span><span class="s">'Tom'</span><span class="p">:</span><span class="mi">22</span><span class="p">,</span><span class="s">'Jerry'</span><span class="p">:</span><span class="mi">23</span><span class="p">,</span><span class="s">'Paul'</span><span class="p">:</span><span class="mi">24</span><span class="p">}</span>
<span class="n">y</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="k">print</span> <span class="n">y</span>
<span class="n">x2</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">x2</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">key</span><span class="p">,</span><span class="s">':'</span><span class="p">,</span><span class="n">val</span></code></pre></figure>

<p>运行程序，可以看到如下结果：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">Test1</span><span class="p">:</span>
<span class="p">[</span><span class="s">"Tom"</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">true</span><span class="p">]</span>
<span class="o">&lt;</span><span class="nb">type</span> <span class="s">'str'</span><span class="o">&gt;</span>
<span class="n">Tom</span> <span class="o">&lt;</span><span class="nb">type</span> <span class="s">'unicode'</span><span class="o">&gt;</span>
<span class="mi">100</span> <span class="o">&lt;</span><span class="nb">type</span> <span class="s">'int'</span><span class="o">&gt;</span>
<span class="bp">True</span> <span class="o">&lt;</span><span class="nb">type</span> <span class="s">'bool'</span><span class="o">&gt;</span>
<span class="n">Test2</span><span class="p">:</span>
<span class="p">[</span><span class="s">"Tom"</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">true</span><span class="p">]</span>
<span class="o">&lt;</span><span class="nb">type</span> <span class="s">'str'</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nb">type</span> <span class="s">'list'</span><span class="o">&gt;</span>
<span class="n">Test3</span>
<span class="p">{</span><span class="s">"Paul"</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s">"Jerry"</span><span class="p">:</span> <span class="mi">23</span><span class="p">,</span> <span class="s">"Tom"</span><span class="p">:</span> <span class="mi">22</span><span class="p">}</span>
<span class="n">Paul</span> <span class="p">:</span> <span class="mi">24</span>
<span class="n">Jerry</span> <span class="p">:</span> <span class="mi">23</span>
<span class="n">Tom</span> <span class="p">:</span> <span class="mi">22</span></code></pre></figure>

<p>首先分析test1的结果。首先x是一个list，序列化为y之后，是一个字符串，可以看出type(y)显示str，并且可以被打印出来。但是要注意的是，当我们同时打印出反序列话后的元素类型，可以看出，原本的str类型被反序列化成为了unicode类型。这只是python 2.7中的特性。自从python 3以后，str类型都会反序列化成为str，所以不必担心。但是在python 2.7中，记得在有些场合可能得到反序列的字符串后，需要将其转换为utf-8格式的str。比如在数据库当中设置了默认utf8，那么当你从json中反序列化拿到字符串之后，可能还要进行encode(‘utf-8’)之后才能存入数据库。事实上今天我就遇到了这一一个问题。然后再由y反序列化得到x2，就又能得到一个list，并且里面元素都可以正常访问。</p>

<p>然后分析test2，x是一个tuple，序列化为y之后打印，可以看出()变为了[]，也就是说，json并不会记录tuple类型，它都会将其认为是list类型（其实本来tuple就可以看做一个只读的list），为了进一步验证，我们将其反序列化得到x2，打印出type(x2)可以看出是list类型。</p>

<p>再看test3，x是一个dict类型，序列化之后原样保存为字符串，反序列话之后依旧还原为dict，并且可以进行正常访问。这里要注意，在python 2.7中dict的key同样会被反序列化为unicode，需要注意。</p>

<p>最后再提一下set类型，当我试图将一个set类型数据序列化的时候会报错，可见json并不支持set类型。</p>

<p>总体可以总结一下：序列化与反序列化之后的对应关系是：list~list,tuple~list,dict~dict,int~int,str~unicode or str,bool~bool。然后set不支持。</p>

<p>最后还需要注意，实际应用中可能经常需要将一个对象序列化。这时候需要编写一个转换函数，这方面的这里不详述了，参考教程即可。</p>

<p>实际应用中才发现json还是使用的满频繁的。javascript当中有时候也经常要处理json，这个也应该注意一下。可以参考这篇教程：<a href="http://www.liaoxuefeng.com/wiki/001434446689867b27157e896e74d51a89c25cc8b43bdb3000/001434499490767fe5a0e31e17e44b69dcd1196f7ec6fc6000">js处理json教程</a></p>

                </div>
                <div class="pager-wrap" style="overflow: hidden;">
                    
                    <a class="pager-pre pager" href="/Users/malingyang/Workspace/mly-zju.github.com/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/2016/01/20/cache.html">上一篇</a>  
                    <a class="pager-next pager" href="/Users/malingyang/Workspace/mly-zju.github.com/html/css/2016/01/02/overflow.html">下一篇</a> 
                </div>
                <!-- 多说评论框 start -->
                <!-- <div class="ds-thread" data-thread-key="/python/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/2016/01/04/serilize" data-title="python中的序列化与反序列化" data-url="http://mly-zju.github.io//python/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/2016/01/04/serilize.html"></div> -->
                <!-- 多说评论框 end -->
                <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
                <!-- <script type="text/javascript">
        var duoshuoQuery = {short_name:"mly-zju"};
          (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';ds.async = true;
            ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0]
             || document.getElementsByTagName('body')[0]).appendChild(ds);
          })();
          </script> -->
                <!-- 多说公共JS代码 end -->

                <!-- UY BEGIN -->
                <div id="uyan_frame"></div>
                <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2130013"></script>
                <!-- UY END -->
            </div>
        </div>
    </div>
    <script src="/Users/malingyang/Workspace/mly-zju.github.com/js/article/index.min.js" type="text/javascript"></script>
</body>

</html>
